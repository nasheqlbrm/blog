{
  "hash": "130dbfec5c341c8ea5235c6516b317e6",
  "result": {
    "engine": "jupyter",
    "markdown": "---\nbadges: true\ncategories:\n- TIL\ntitle: \"Streaks\"\ndescription: \"Games of chance\"\nauthor: \"Kaushik Sinha\"\ndate: \"12/19/2024\"\ndraft: false \nformat: live-html\nbibliography: ../../references.bib\ntoc: true\npyodide:\n  packages:\n    - numpy\n    - pandas\n    - ipywidgets\n    - jinja2\n---\n\n\n# Introduction\n\nFollowing the treatment in @dorhauer_07032019, suppose we have a game where\n\n* a team has $p$ probability of winning a round of the game (aka hit-rate)\n* $q=1-p$ is the probability of losing a round of the game\n* $n$ is the number of independent rounds of the game\n* $r \\in [0,\\ldots,n]$ denotes the length of a streak\n    * An $r$-game losing streak means you lose $r$ consecutive games.\n\n## How many $r$ game windows are possible within $n$ rounds?\nTo make this concrete, let $r=3$ and $n=10$. There are $8$ different $3$-game windows where a streak could occur within $10$ game rounds (games 1-3, 2-3,…,8-10). So there are $n-r$ different $r$ game windows possible within $n$ rounds. \n\n## How many opportunities are there to start a winning streak?\nIn $n$ rounds, any $r$-game winning streak will have to start by game $n-r+1$ at the latest. Thus, in $10$ rounds, any $3$-game winning streak  will have to start by game $8$ at the latest. Any loss in the first $n-r$ games can potentially be followed by a $r$-game winning streak. For a $p$ hit-rate team, we expect $(n-r)q$ losses over the first $n-r$ games, plus the first game (which can always start a winning streak as there is no loss from a previous game to consider). That means a $p$ hit-rate team will have, on average, about $1+(n-r)q$ opportunities to begin a winning streak of at least $r$ games.\n\nSimilarly, in $n$ rounds, any $r$-game losing streak will have to start by game $n-r+1$ at the latest. Any win in the first $n-r$ games can potentially be followed by a $r$-game losing streak. For a $p$ hit-rate team, we expect $(n-r)p$ wins over the first $n-r$ games, plus the first game (which can always start a losing streak as there is no win from a previous game to consider). That means a $p$ hit-rate team will have, on average, about $1+(n-r)p$ opportunities to begin a losing streak of at least $r$ games.\n\n## The expected number of losing streaks\nThe expected number of losing streaks is the product of the expected number of opportunities to start a losing streak times the probability of $r$ consecutive losses, so $(1+(n−r)p)q^{r}$\n\n\n```{pyodide}\nn = 200 # number of rounds of the game\nr = 4 # length of losing streak\np = 0.6 # probability of win\nq = 1-p # probability of loss\nels = (1 + (n-r)*p)*(q**r) #expected losing streaks\nprint(f'The expected number of losing streaks of length {r} somewhere among {n} independent rounds of the game is approximately {els:1.4f}')\n```\n\n\n## The probability of at least one losing streak\nThe probability of at least one losing streak is 1 minus the probability of $0$ losing streaks. We first determine the probability of not completing a losing streak at every one of the opportunities we have for starting a losing streak. So, in other words, we will find the probability of having a winning streak at every one of these opportunities.\n\nNow $q^{r}$ is the probability of having a losing streak at any opportunity. Hence, $(1-q^{r})$ is the probability of having a winning streak at any opportunity. So, $(1-q^{r})^{1+(n−r)p}$ is the probability of having a winning streak at each and every one of the $1+(n−r)p$ opportunities for starting a losing streak.\n\nFinally, we have that $1 - (1-q^{r})^{1+(n−r)p}$ is the probability of at least one losing streak.\n\n\n```{pyodide}\nn = 200 # number of rounds of the game\nr = 4 # length of losing streak\np = 0.6 # probability of win\nq = 1-p # probability of loss\nprob = 1 - ( (1 - (q**r) )** (1+(n-r)*p) )\nprint(f'The probability of at least one losing streak of length {r} somewhere among {n} independent rounds of the game is approximately {prob:1.4%}')\n```\n\n\n## The longest expected losing streak\n\nFrom @soccerwidow_streaks_note, the length of the longest expected losing streak is given by $\\frac{|ln(n)|}{|ln(q)|}$. \n\n\n```{pyodide}\nimport pandas as pd\nimport numpy as np\nn = 50 # number of rounds of the game\nqs = np.arange(0.1,1,0.1) #range for the loss probability \ndf = (pd.DataFrame({'q': qs, 'n': [n]*len(qs)})\n    .assign(hit_rate = lambda df_: (1.0 - df_.q),\n            odds = lambda df_: df_.hit_rate.pow(-1),\n            max_losing_streak = lambda df_: np.abs(np.log(df_.n)\n                                                   .div(np.log(df_.q))\n                                                  )\n           )\n    [['q','odds','max_losing_streak','n']]\n     )\ndf.style \\\n  .format(precision=2, thousands=\",\")\n```\n\n\nSimilarly, the length of the longest expected winning streak is $\\frac{|ln(n)|}{|ln(p)|}$.\n\n## The number of rounds played to encounter a losing streak of a particular length\n\nFrom @soccerwidow_streaks_note, for a game where the probability of losing at any given round is $q$, we expect to have encountered a losing streak of length $r$ somewhere on or before $\\frac{1}{q^{r}}$ rounds.\n\n\n```{pyodide}\nfrom itertools import chain\nimport pandas as pd\nimport numpy as np\nqs = np.arange(0.5,0.61,0.05) #range for the loss probability \nstreak_lengths = [3, 5, 10]\nrs = chain.from_iterable( [ [r] * len(qs) for r in streak_lengths ] )\ndf = (pd.DataFrame({'q': np.tile(qs, len(streak_lengths)),\n                    'r': rs\n                   })\n    .assign(hit_rate = lambda df_: (1.0 - df_.q),\n            odds = lambda df_: df_.hit_rate.pow(-1),\n            n = lambda df_: df_.q.pow(-1).pow(df_.r)\n           )\n    .drop(columns=['hit_rate'])\n    .pivot(index=['q','odds'], columns=['r'], values=['n'])  \n    .reset_index()\n    .sort_values(by=['q'], ascending=False)\n     )\ndf.style \\\n  .format(precision=2, thousands=\",\")\n```\n\n\n## Starting Bankroll\nFor strategies with a hit rate between 45% to 55% the starting bank roll should be (Length of maximum losing streak X planned stake per bet X 5)\n\n",
    "supporting": [
      "index_files"
    ],
    "filters": [],
    "includes": {}
  }
}